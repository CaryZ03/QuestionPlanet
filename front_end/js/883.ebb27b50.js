"use strict";(self["webpackChunkquestion_planet"]=self["webpackChunkquestion_planet"]||[]).push([[883],{883:function(t,e,s){s.r(e),s.d(e,{default:function(){return r}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("el-collapse",{staticClass:"col-md-3 d-none d-lg-block bg-light sidebar",model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},[e("el-collapse-item",{staticClass:"tool",attrs:{name:"1"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-circle-check"}),t._v("单选题 ")]),e("div",{staticClass:"tool-body"},[e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"问卷中用户只能选中一个选项作为答案。",placement:"bottom"}},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("single")}}},[t._v("添加单选题")])],1)],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"2"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-circle-check"}),e("i",{staticClass:"el-icon-circle-check"}),t._v("多选题 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("multiple")}}},[t._v("添加多选题")])],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"3"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-edit-outline"}),t._v("填空题 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("text")}}},[t._v("添加填空题")])],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"4"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-star-off"}),t._v("评分题 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("grade")}}},[t._v("添加评分题")])],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"5"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-s-data"}),t._v("判断题 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("judge")}}},[t._v("添加判断题")])],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"6"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-picture-outline"}),t._v("图片选择题 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""},on:{click:function(e){return t.addQuestion("image")}}},[t._v("添加图片选择题")])],1)],2),e("el-collapse-item",{staticClass:"tool mb-2",attrs:{name:"7"}},[e("template",{slot:"title"},[e("i",{staticClass:"el-icon-s-data"}),t._v("进度条 ")]),e("div",{staticClass:"tool-body"},[e("el-button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"primary",icon:"el-icon-circle-plus",size:"small",round:""}},[t._v("添加进度条")])],1)],2)],1),e("div",{staticClass:"question-card",attrs:{id:"question-list"}},[e("el-container",{staticClass:"card mb-2",staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[e("el-main",[e("span",{staticClass:"red_star"},[t._v("* ")]),e("span",{staticClass:"title"},[t._v("问卷标题")]),e("el-input",{attrs:{placeholder:"请输入问卷标题",clearable:""},model:{value:t.qn_title,callback:function(e){t.qn_title=e},expression:"qn_title"}})],1)],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("el-container",{staticClass:"card mb-2",staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[e("el-main",[e("span",{staticClass:"red_star"},[t._v("* ")]),e("span",{staticClass:"title"},[t._v("问卷截止填写时间")]),e("br"),e("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",format:"yyyy-MM-dd HH:mm:ss"},model:{value:t.qn_end_time,callback:function(e){t.qn_end_time=e},expression:"qn_end_time"}})],1)],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),t._l(t.questions,(function(s,i){return e("div",{key:i,staticClass:"card mb-2",attrs:{id:i}},[e("el-container",{staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[s.isEdit?e("el-main",[s.q_mandatory?e("span",{staticClass:"red_star"},[t._v("* ")]):e("span",{staticClass:"red_star"}),"single"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".单选题")]):t._e(),"multiple"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".多选题")]):t._e(),"text"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".填空题")]):t._e(),"judge"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".判断题")]):t._e(),"grade"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".打分题")]):t._e(),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("div",{staticClass:"title"},[t._v("标题")]),e("el-input",{attrs:{placeholder:"请输入标题",clearable:""},model:{value:s.q_title,callback:function(e){t.$set(s,"q_title",e)},expression:"question.q_title"}}),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),"single"===s.q_type||"multiple"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("选项")])]),t._l(s.q_options,(function(s,n){return e("div",{key:n,staticClass:"single_choice_ques"},[e("el-row",[e("el-col",{attrs:{span:3}},[e("div",[e("el-button",{attrs:{type:"danger",icon:"el-icon-minus",circle:"",size:"small"},on:{click:function(e){return t.deleteNode(i,n)}}})],1)]),e("el-col",{attrs:{span:21}},[e("div",[e("el-input",{attrs:{placeholder:"请输入题目内容",clearable:""},model:{value:s.label,callback:function(e){t.$set(s,"label",e)},expression:"item.label"}})],1)])],1)],1)})),e("el-row",[e("el-col",{attrs:{span:3}},[e("div",[e("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(e){return t.addNode(i)}}})],1)]),e("el-col",{attrs:{span:21}},[e("div",{staticStyle:{"line-height":"200%",color:"#0099ff"}},[t._v("添加选项")])])],1)],2):"text"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("内容")])]),e("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):"judge"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("选项")])]),e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},[e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:0}},[t._v("错误")]),e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:1}},[t._v("正确")])],1)],1):"grade"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("评分")])]),e("el-rate",{attrs:{colors:t.grade_colors},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):t._e(),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("设置")])]),e("el-row",[e("el-col",{attrs:{span:21}},[e("div",{staticStyle:{"line-height":"200%",color:"#F3F2F2"}},[t._v("此题目必须回答")])]),e("el-col",{attrs:{span:3}},[e("el-switch",{attrs:{"active-color":"#0099ff","inactive-color":"#c2bdbd"},model:{value:s.q_mandatory,callback:function(e){t.$set(s,"q_mandatory",e)},expression:"question.q_mandatory"}})],1)],1)],1):e("el-main",[s.q_mandatory?e("span",{staticClass:"red_star"},[t._v("* ")]):e("span",{staticClass:"red_star"}),"single"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".单选题")]):t._e(),"multiple"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".多选题")]):t._e(),"text"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".填空题")]):t._e(),"judge"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".判断题")]):t._e(),"grade"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".打分题")]):t._e(),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("div",{staticStyle:{color:"#F3F2F2"}},[t._v("题目："+t._s(s.q_title))]),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),"single"===s.q_type||"multiple"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("选项")])]),"single"===s.q_type?e("div",[e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},t._l(s.q_options,(function(s,i){return e("el-radio",{key:i,staticStyle:{color:"#F3F2F2"},attrs:{label:i}},[t._v(t._s(s.label))])})),1)],1):t._e(),"multiple"===s.q_type?e("div",t._l(s.q_options,(function(s,i){return e("div",{key:i},[e("el-checkbox",{staticStyle:{color:"#F3F2F2"},attrs:{label:i},model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"option.checked"}},[t._v(t._s(s.label))])],1)})),0):t._e()]):"text"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("内容")])]),e("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):"judge"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("选项")])]),e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},[e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:0}},[t._v("错误")]),e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:1}},[t._v("正确")])],1)],1):"grade"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("评分")])]),e("el-rate",{attrs:{colors:t.grade_colors},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):t._e()]),e("el-footer",[s.isEdit?e("el-button",{attrs:{icon:"el-icon-folder-checked",circle:""},on:{click:function(e){return t.change_to_save_mode(i)}}}):e("el-button",{attrs:{icon:"el-icon-edit",circle:""},on:{click:function(e){return t.change_to_edit_mode(i)}}}),t._v("      "),e("el-button",{attrs:{icon:"el-icon-document-copy",circle:""},on:{click:function(e){return t.dup_question(i)}}}),t._v("      "),e("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(e){return t.removeQuestion(i)}}}),t._v("      "),e("el-button",{attrs:{icon:"el-icon-top",circle:""},on:{click:function(e){return t.upNode(i)}}}),t._v("      "),e("el-button",{attrs:{icon:"el-icon-bottom",circle:""},on:{click:function(e){return t.downNode(i)}}})],1)],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")])],1)})),e("el-button",{staticStyle:{margin:"0 0 0 214px"},attrs:{type:"success",round:""},on:{click:function(e){return t.save_questionnaire()}}},[t._v("保存问卷")]),e("el-button",{attrs:{type:"primary",round:""},on:{click:function(e){return t.submit_questionnaire()}}},[t._v("提交问卷")])],2),e("div",{staticClass:"outline-area"},[e("div",{staticClass:"outline-title"},[t._v("问卷大纲")]),e("div",{staticClass:"outline-list"},t._l(t.questions,(function(s,i){return e("el-link",{key:i,staticClass:"outline-item",on:{click:function(e){return e.preventDefault(),t.scrollToQuestion(s,i)}}},[t._v(t._s(i+1)+"."+t._s(s.q_title))])})),1)]),e("router-view")],1)},n=[],a=(s(7658),{name:"createQuestionnaire",data(){return{uid:this.$store.state.curUserID,qn_id:"",qn_title:"",qn_description:"",qn_end_time:"",qn_refillable:!0,questions:[],activeNames:["1","2","3","4","5","6","7"],grade_colors:["#99A9BF","#F7BA2A","#FF9900"]}},created(){this.qn_id=this.$route.params.qn_id,this.load_qn()},methods:{load_qn(){var t=this;this.$api.questionnaire.getQuestionnaire_Check(this.$route.params.qn_id).then((function(e){console.log(e),console.log(e.data.qn_info),console.log(e.data.question_list);const s=JSON.parse(e.data.qn_info),i=e.data.question_list;console.log(s),t.qn_title=s.qn_title,t.qn_end_time=s.qn_end_time,t.qn_description=s.qn_description,t.qn_refillable=s.qn_refillable,i.forEach((e=>{const s=JSON.parse(e);s.q_options=JSON.parse(s.q_options),s.isEdit=!0,t.questions.push(s)}))})).catch((function(t){console.log(t)})),console.log(this.qn_id)},addQuestion(t){let e={q_type:t,isEdit:!0,q_mandatory:!0,q_title:"",q_options:[],q_description:"",a_content:"",q_correct_answer:"",q_score:0};"single"!==t&&"multiple"!==t||(e.q_options=[{label:"选项1",checked:!1,num:0},{label:"选项2",checked:!1,num:0}]),e.id="question-"+(this.questions.length+1),this.questions.push(e)},save_handler(){const t=this.questions.map((t=>({q_type:t.q_type,q_mandatory:t.q_mandatory,q_title:t.q_title,q_description:t.q_description,q_option_count:t.q_options.length,q_options:t.q_options,q_correct_answer:t.q_correct_answer,q_score:t.q_score}))),e=this.qn_end_time,s=new Date(e),i={year:"numeric",month:"2-digit",day:"2-digit"},n=s.toLocaleDateString("en-US",i).replace(/\//g,"-"),a=s.toLocaleTimeString("en-US",{hour12:!1}),[l,o,c]=n.split("-"),r=`${c}-${o}-${l} ${a}`;console.log(r);const _={uid:this.$store.curUserID,qn_id:this.qn_id,qn_title:this.qn_title,qn_description:this.qn_description,qn_end_time:r,qn_refillable:this.qn_refillable,question_list:t},d=JSON.stringify(_);console.log(d),this.$api.questionnaire.postQuestionnaire_Save(d).then((function(t){console.log(t)})).catch((function(t){console.log(t)}))},save_questionnaire(){this.save_handler(),this.$alert("问卷保存成功！","保存问卷",{confirmButtonText:"确定"})},submit_questionnaire(){this.$confirm("是否提交问卷?","提交问卷",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.saveQuestionnaire(),this.$message({type:"success",message:"提交成功!"}),this.$router.push({path:"/manage/"+this.$store.state.curUserID})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})}))},addNode(t){this.questions[t].q_options.push({label:"选项",checked:!1})},deleteNode(t,e){this.questions[t].q_options.splice(e,1)},dup_question(t){let e={q_type:this.questions[t].q_type,isEdit:!0,q_mandatory:this.questions[t].q_mandatory,q_title:this.questions[t].q_title,q_options:this.questions[t].q_options,q_description:this.questions[t].q_description,a_content:this.questions[t].a_content,q_correct_answer:this.questions[t].q_correct_answer,q_score:this.questions[t].q_score};console.log(e),this.questions.splice(t,0,e)},upNode(t){t<=0||([this.questions[t-1],this.questions[t]]=[this.questions[t],this.questions[t-1]],this.$forceUpdate())},downNode(t){t>=this.questions.length-1||([this.questions[t+1],this.questions[t]]=[this.questions[t],this.questions[t+1]],this.$forceUpdate())},change_to_save_mode(t){this.questions[t].isEdit=!1},change_to_edit_mode(t){this.questions[t].isEdit=!0},removeQuestion(t){this.questions.splice(t,1)},selectStar(t,e){for(let s=0;s<t.stars.length;s++)s<=e?t.stars.splice(s,1,!0):t.stars.splice(s,1,!1)},dragStart(t,e,s){t.preventDefault(),t.stopPropagation(),t.dataTransfer.setData("text/plain",""),t.target.parentElement.classList.add("dragging"),this.dragOption=s,this.dragQuestion=e},dragEnd(t,e,s){t.preventDefault(),t.stopPropagation(),t.target.parentElement.classList.remove("dragging");let i=e.options.indexOf(s),n=e.options.indexOf(this.dragOption);i>n?e.options.splice(i+1,0,this.dragOption):e.options.splice(i,0,this.dragOption),e.options.splice(n,1),this.dragOption=null,this.dragQuestion=null},selectImage(t,e){t.images.forEach(((t,s)=>{t.selected=e===s}))},scrollToQuestion(t,e){this.$nextTick((()=>{console.log(e);const t=document.getElementById(e);console.log(t),t&&t.scrollIntoView({behavior:"smooth"})}))}}}),l=a,o=s(1001),c=(0,o.Z)(l,i,n,!1,null,"7aa6c41e",null),r=c.exports}}]);
//# sourceMappingURL=883.ebb27b50.js.map