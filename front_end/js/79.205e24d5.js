"use strict";(self["webpackChunkquestion_planet"]=self["webpackChunkquestion_planet"]||[]).push([[79],{9079:function(t,e,s){s.r(e),s.d(e,{default:function(){return r}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"row"},[e("div",{staticClass:"question-card",staticStyle:{margin:"0 0 0 -62px"},attrs:{id:"question-list"}},[e("el-container",{staticClass:"card mb-2",staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[e("el-main",[e("span",{staticStyle:{color:"#F3F2F2"}},[t._v("问卷标题："+t._s(this.qn_title))])])],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("el-container",{staticClass:"card mb-2",staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[e("el-main",[e("span",{staticStyle:{color:"#F3F2F2"}},[t._v("问卷描述："+t._s(this.qn_description))])])],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),t._l(t.questions,(function(s,i){return e("div",{key:i,staticClass:"card mb-2",attrs:{id:s.id}},[e("el-container",{staticStyle:{"box-shadow":"0 2px 4px rgba(0, 0, 0, .12), 0 0 6px rgba(0, 0, 0, .04)"}},[e("el-main",{attrs:{id:`question-${i}`}},[t.qn_is_normal||t.qn_is_test?e("div",[s.q_mandatory?e("span",{staticClass:"red_star"},[t._v("* ")]):e("span",{staticClass:"red_star"}),"single"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".单选题")]):t._e(),"multiple"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".多选题")]):t._e(),"text"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".填空题")]):t._e(),"judge"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".判断题")]):t._e(),"grade"===s.q_type?e("span",{staticStyle:{color:"#F3F2F2"}},[t._v(t._s(i+1)+".打分题")]):t._e()]):t.qn_is_vote?e("div",[e("span",{staticStyle:{color:"#F3F2F2"}},[t._v("投票")])]):t.qn_is_application?e("div",[e("span",{staticStyle:{color:"#F3F2F2"}},[t._v("报名")])]):t._e(),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("div",{staticStyle:{color:"#F3F2F2"}},[t._v("题目："+t._s(s.q_title))]),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),e("div",{staticStyle:{color:"#F3F2F2"}},[t._v("问题描述："+t._s(s.q_description))]),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),t.qn_is_application?e("div",["single"===s.q_type||"multiple"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title"},[t._v("选项")])]),"single"===s.q_type?e("div",[e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},t._l(s.q_options,(function(s,i){return e("el-radio",{key:i,staticStyle:{color:"#F3F2F2"},attrs:{label:i,disabled:s.disabled}},[t._v(t._s(s.label)+"    剩余人数："+t._s(s.num))])})),1)],1):t._e(),"multiple"===s.q_type?e("div",t._l(s.q_options,(function(s,i){return e("div",{key:i},[e("el-checkbox",{staticStyle:{color:"#F3F2F2"},attrs:{label:i},model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"option.checked"}},[t._v(t._s(s.label)+"   剩余人数："+t._s(s.num))])],1)})),0):t._e()]):"text"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("内容")])]),e("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):"judge"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("选项")])]),e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},[e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:0}},[t._v("错误")]),e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:1}},[t._v("正确")])],1)],1):"grade"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("评分")])]),e("el-rate",{attrs:{colors:t.grade_colors},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):t._e()]):e("div",["single"===s.q_type||"multiple"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("选项")])]),"single"===s.q_type?e("div",[e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},t._l(s.q_options,(function(s,i){return e("el-radio",{key:i,staticStyle:{color:"#F3F2F2"},attrs:{label:i}},[t._v(t._s(s.label))])})),1)],1):t._e(),"multiple"===s.q_type?e("div",t._l(s.q_options,(function(s,i){return e("div",{key:i},[e("el-checkbox",{staticStyle:{color:"#F3F2F2"},attrs:{label:i},model:{value:s.checked,callback:function(e){t.$set(s,"checked",e)},expression:"option.checked"}},[t._v(t._s(s.label))])],1)})),0):t._e()]):"text"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("内容")])]),e("el-input",{attrs:{type:"textarea",autosize:"",placeholder:"请输入内容"},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):"judge"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("选项")])]),e("el-radio-group",{model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}},[e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:0}},[t._v("错误")]),e("el-radio",{staticStyle:{color:"#F3F2F2"},attrs:{label:1}},[t._v("正确")])],1)],1):"grade"===s.q_type?e("div",[e("div",{staticClass:"division"},[e("span",{staticClass:"title",staticStyle:{color:"#F3F2F2"}},[t._v("评分")])]),e("el-rate",{attrs:{colors:t.grade_colors},model:{value:s.a_content,callback:function(e){t.$set(s,"a_content",e)},expression:"question.a_content"}})],1):t._e()]),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")]),t.qn_is_test?e("div",{staticStyle:{color:"#F3F2F2"}},[t._v(" "+t._s(s.q_reflect)+" ")]):t._e(),t.qn_is_vote?e("div",{staticClass:"echart",style:t.myChartStyle,attrs:{id:"barChart"}}):t._e()])],1),e("div",{staticStyle:{"line-height":"30px"}},[t._v(" ")])],1)})),e("el-button",{staticClass:"button",staticStyle:{margin:"0 0 0 214px"},attrs:{type:"success",round:""},on:{click:function(e){return t.submit_handler()}}},[t._v("保存回答")]),e("el-button",{staticClass:"button",attrs:{type:"primary",round:""},on:{click:function(e){return t.submit_answer()}}},[t._v("提交回答")])],2),e("router-view")],1)},n=[],a=(s(7658),s(2210)),o={name:"createQuestionnaire",data(){return{uid:this.$store.state.curUserID,qn_id:"",as_id:"",qn_title:"这是问卷标题",qn_type:"normal",qn_type_options:[{value:"normal",label:"普通问卷"},{value:"test",label:"考试问卷"},{value:"vote",label:"投票问卷"},{value:"application",label:"报名问卷"}],qn_description:"",qn_end_time:"",qn_refillable:"",questions:[],answer_sheet:[],grade_colors:["#99A9BF","#F7BA2A","#FF9900"],qn_is_normal:!1,qn_is_test:!1,qn_is_vote:!1,qn_is_application:!0,questions_vote:[],myChartStyle:{float:"left",width:"100%",height:"400px"},test_is_submitted:!1}},created(){this.create_as()},methods:{change_to_qn_normal(){this.qn_is_normal=!0,this.qn_is_test=!1,this.qn_is_vote=!1,this.qn_is_application=!1},change_to_qn_test(){this.qn_is_normal=!1,this.qn_is_test=!0,this.qn_is_vote=!1,this.qn_is_application=!1},change_to_qn_vote(){this.qn_is_normal=!1,this.qn_is_test=!1,this.qn_is_vote=!0,this.qn_is_application=!1},change_to_qn_application(){this.qn_is_normal=!1,this.qn_is_test=!1,this.qn_is_vote=!1,this.qn_is_application=!0},create_as(){var t=this;this.$api.questionnaire.postQuestionnaire_Fill(this.$route.params.key).then((function(e){0==e.data.errno?(t.qn_id=e.data.qn_id,console.log(t.qn_id),console.log(e),t.as_id=e.data.as_id,console.log(t.as_id),t.load_qn()):(alert("寄啦！"),t.$router.push({name:"home"}))})).catch((function(t){console.log(t)}))},load_qn(){var t=this;this.$api.questionnaire.getQuestionnaire_Check(this.qn_id).then((function(e){console.log(e.data),console.log(e.data.question_list);const s=JSON.parse(e.data.qn_info),i=e.data.question_list;t.qn_title=s.qn_title,t.qn_id=s.qn_id,t.qn_end_time=s.qn_end_time,t.qn_type=s.qn_type,"normal"===t.qn_type?t.change_to_qn_normal():"test"===t.qn_type&&t.change_to_qn_test(),"vote"===t.qn_type&&t.change_to_qn_vote(),"application"===t.qn_type&&t.change_to_qn_application(),t.qn_description=s.qn_description,t.qn_refillable=s.qn_refillable,i.forEach((e=>{const s=JSON.parse(e);s.q_options=JSON.parse(s.q_options),s.q_reflect="",t.questions.push(s)}))})).catch((function(t){console.log(t)})),console.log(this.qn_id)},application_handler(){const t={qn_id:this.qn_id,n:this.questions[1].a_content},e=JSON.stringify(t);console.log(this.questions[1].a_content),console.log(e),this.$api.data.postAnswers_process(e).then((function(t){console.log(t)})).catch((function(t){console.log(t)}))},submit_handler(){this.answer_sheet.splice(0,this.answer_sheet.length),this.questions.forEach(((t,e)=>{let s=[];"multiple"===t.q_type&&(t.q_options.forEach(((t,e)=>{t.checked&&s.push(e.toString())})),t.a_content=s.join(",")),this.answer_sheet.push({q_id:t.q_id,a_content:t.a_content})})),console.log(this.answer_sheet);const t={qn_id:this.qn_id,as_id:this.as_id,answer_data:JSON.stringify(this.answer_sheet)},e=JSON.stringify(t);console.log(e),this.$api.questionnaire.postAnswer_Submit(e).then((function(t){console.log(t)})).catch((function(t){console.log(t)})),"application"===this.qn_type?this.application_handler():"vote"===this.qn_type&&(this.vote_analyze(),console.log(this.questions_vote),setTimeout((()=>{this.drawBarCharts()}),100)),this.$message({type:"success",message:"保存成功"})},judge_handler(t,e){const s="question-"+t,i=document.getElementById(s);if(console.log(i),"text"===this.questions[t].q_type)return this.questions[t].q_reflect="填空题需要人工评判",void(i.style.backgroundColor="rgba(255, 221, 5, 0.4)");!0===e?(this.questions[t].q_reflect="回答正确",i.style.backgroundColor="rgba(75, 201, 70, 0.52)"):(this.questions[t].q_reflect="回答错误，正确答案为第"+this.questions[t].q_correct_answer+"项。",i.style.backgroundColor="rgba(209, 48, 48, 0.47)")},test_judge(){this.questions.forEach(((t,e)=>{if("single"===t.q_type){const s=t.a_content.toString();s==t.q_correct_answer?(console.log(`${e} 单选题回答正确`),this.judge_handler(e,!0)):(console.log(`${e} 单选题回答错误`),this.judge_handler(e,!1))}else"multiple"===t.q_type?t.a_content==t.q_correct_answer?(console.log(`${e} 多选题回答正确`),this.judge_handler(e,!0)):(console.log(`${e} 多选题回答错误`),this.judge_handler(e,!1)):"text"===t.q_type&&(console.log(`${e} 填空题需要人工评判`),this.judge_handler(e,!1))}))},submit_answer(){"normal"!==this.qn_type&&"vote"!==this.qn_type&&"test"!==this.qn_type||this.submit_handler();try{this.questions.forEach(((t,e)=>{if(t.q_mandatory&&(null===t.a_content||void 0===t.a_content||""===t.a_content))throw new Error("请注意，您有必答题目未填写")}))}catch(t){return void this.$message({type:"error",message:t.message})}"normal"===this.qn_type||"application"===this.qn_type?this.$confirm("是否提交回答?","提交回答",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.submit_handler(),this.$message({type:"success",message:"提交成功"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})})):"test"===this.qn_type?this.test_is_submitted?this.$confirm("是否提交回答?","提交回答",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$message({type:"error",message:"已经提交过一次了哦"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})})):(this.test_is_submitted=!0,this.$confirm("是否提交回答?","提交回答",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.submit_handler(),this.test_judge(),this.$message({type:"success",message:"提交成功,已展示测试结果"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})}))):"application"===this.qn_type?this.test_is_submitted?this.$confirm("是否提交回答?","提交回答",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$message({type:"error",message:"已经提交过一次了哦"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})})):(this.test_is_submitted=!0,this.$confirm("是否提交回答?","提交回答",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.submit_handler(),this.$message({type:"success",message:"提交成功"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})}))):"vote"===this.qn_type&&this.$confirm("是否提交投票?","提交投票",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.submit_handler(),this.$message({type:"success",message:"提交成功,已展示投票结果"})})).catch((()=>{this.$message({type:"info",message:"已取消提交"})}))},drawBarCharts(){const t="barChart",e=document.getElementById(t);console.log(e),console.log(this.questions_vote);const s=a.S1(e),i={xAxis:{data:this.questions_vote[0].q_options.map((t=>t.label.label))},yAxis:{},series:[{type:"bar",data:this.questions_vote[0].q_options.map((t=>t.num))}]};s.setOption(i),window.addEventListener("resize",(()=>{s.resize()}))},vote_analyze(){var t=this;this.$api.data.getQuestionnaire_Analyze(this.qn_id).then((function(e){console.log(e.data.result.questionnaire_title),t.questions_vote=e.data.result.q_results,console.log(t.questions_vote)})).catch((function(t){console.log(t)}))}}},l=o,c=s(1001),_=(0,c.Z)(l,i,n,!1,null,"525deb25",null),r=_.exports}}]);
//# sourceMappingURL=79.205e24d5.js.map